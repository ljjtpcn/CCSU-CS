# 数据完整性约束

为了保证数据的完整性和正确性，数据库提供了一系列的约束供我们使用。常用的约束有$6$种：`主键(primary key)约束， 外键(foreign key)约束，唯一(unique)约束， 默认值(default)约束， 非空(not null)约束以及检查(check)约束。`

数据完整性约束包括：

+ 定义实体完整性（主键约束， 候选键（唯一）约束）
+  定义参照完整性（外键约束）
+ 定义用户完整性~~（也叫域完整性）~~（非空约束，默认值约束，自增，check约束，触发器约束等）

## 定义实体完整性

实体完整性规则：关系的主属性不能为空，即主键和候选键在关系中所对应的属性值不能为空值，实体完整性通过主键约束和候选键约束来实现。

## 定义参照完整实体完整性规则：

关系的主属性不能为空，即主键和候选键在关系中所对应的属性值不能为空值，实体完整性通过主键约束和候选键约束来实现。性

实体完整性规则：如果属性集`K`是关系模式`R1`的主键，`K`也是关系模式`R2`的外键，那么`R2`的关系中，`K`的取值只允许有两种可能：

`①`空值 

`②`等于`R1`关系中对应属性的某个主键值。这条规则的实质是**不允许引用不存在的实体**

## 用户定义完整性约束

+ check约束

    通过限制列的可接受值，强制域的完整性。

+ 规则约束

+ unique约束

    禁止出现重复的值



# 四种外键约束

外键约束比较多得两种情况： 

1. 父表更新时子表也更新，父表删除时如果子表有匹配的项，删除失败；

```mysql
ON UPDATE CASCADE ON DELETE RESTRICT
-- ON UPDATE CASCADE 父表更新，子表同步更新
-- ON DELETE RESTRICT 父表删除， 如果子表有匹配项，删除失败
```

2. 父表更新时子表也更新，父表删除时子表匹配的项也删除；

```mysql
ON UPDATE CASCADE ON DELETE CASCADE
-- ON UPDATE CASCADE 父表更新，子表同步更新
-- ON DELETE CASCADE 父表删除， 子表匹配项也删除
```

## RESTRICT

`RESTRICT`：拒绝删除或者更新父表。指定`RESTRICT`（或者`NO ACTION`）或忽略（不写）`ON DELETE`或者`ON UPDATE`选项的效果是一样的

## NO ACTION

`NO ACTION`：**InnoDB**拒绝删除或者更新父表（同`RESTRICT`）

## CASCADE

`CASCADE`： 从父表中删除或更新对应的行，同时自动的删除或更新自表中匹配的行。`ON DELETE CASCADE`和`ON UPDATE CASCADE`都被**InnoDB**所支持

## SET NULL

`SET NULL`：从父表中删除或更新对应的行，同时将子表中的外键列设为空。**注意，这些在外键列没有被设为NOT NULL时才有效。**`**ON DELETE SET NULL`和`ON UPDATE SET SET NULL`都被**InnoDB**所支持。

> 外键使用需要满足的条件： 
>
> 1. 两张表必须都是**InnoDB**表，并且它们没有临时表。 
> 2. 建立外键关系的对应列必须具有相似的**InnoDB**内部数据类型。 
> 3. 建立外键关系的对应列必须建立了索引。

